<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>datasplash.pubsub documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Datasplash</span> <span class="project-version">0.6.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>datasplash</span></div></div></li><li class="depth-2 branch"><a href="datasplash.api.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></a></li><li class="depth-2 branch"><a href="datasplash.bq.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bq</span></div></a></li><li class="depth-2 branch"><a href="datasplash.datastore.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>datastore</span></div></a></li><li class="depth-2 current"><a href="datasplash.pubsub.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pubsub</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="datasplash.pubsub.html#var-decode-messages"><div class="inner"><span>decode-messages</span></div></a></li><li class="depth-1"><a href="datasplash.pubsub.html#var-encode-messages"><div class="inner"><span>encode-messages</span></div></a></li><li class="depth-1"><a href="datasplash.pubsub.html#var-read-from-pubsub"><div class="inner"><span>read-from-pubsub</span></div></a></li><li class="depth-1"><a href="datasplash.pubsub.html#var-write-to-pubsub"><div class="inner"><span>write-to-pubsub</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">datasplash.pubsub</h1><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-decode-messages"><h3>decode-messages</h3><div class="usage"><code>(decode-messages options p)</code></div><div class="doc"><div class="markdown"><p>Converts the input PubsubMessages to clojure objects. To use after <code>read-from-pubsub</code> with type <code>:raw</code>.</p>
<p>Returns an map with a <code>:payload</code> key and an <code>:attributes</code> key, assumes the payload is UTF-8 encoded</p></div></div><div class="src-link"><a href="https://github.com/ngrunwald/datasplash/blob/v0.6.0/src/clj/datasplash/pubsub.clj#L35">view source</a></div></div><div class="public anchor" id="var-encode-messages"><h3>encode-messages</h3><div class="usage"><code>(encode-messages options p)</code></div><div class="doc"><div class="markdown"><p>Converts the input to PubsubMessages. To use before <code>write-to-pubsub</code> with type <code>:raw</code>.</p>
<p>Takes as input a map with a <code>:payload</code> key and an <code>:attributes</code> key, assumes the payload is UTF-8 encoded</p></div></div><div class="src-link"><a href="https://github.com/ngrunwald/datasplash/blob/v0.6.0/src/clj/datasplash/pubsub.clj#L28">view source</a></div></div><div class="public anchor" id="var-read-from-pubsub"><h3>read-from-pubsub</h3><h4 class="added">added in 0.4.0</h4><div class="usage"><code>(read-from-pubsub subscription-or-topic {:keys [kind timestamp-label type], :or {kind :subscription, type :string}, :as options} p)</code><code>(read-from-pubsub subscription-or-topic p)</code></div><div class="doc"><div class="markdown"><p>Create an unbounded PCollection from a pubsub stream.</p>
<p>See <a href="https://cloud.google.com/dataflow/model/pubsub-io#reading-with-pubsubio">https://cloud.google.com/dataflow/model/pubsub-io#reading-with-pubsubio</a>.</p>
<p>Examples:</p>
<pre><code>(ps/read-from-pubsub "projects/my-project/subscriptions/my-subscription" pcoll)

;; payload will be a string and attributes a map
(-&gt;&gt; (ps/read-from-pubsub "projects/my-project/subscriptions/my-subscription" {:type :raw} pcoll)
     (ps/decode-messages)
     (ds/map (fn [{:keys [payload attributes]}] (json/decode payload))))
</code></pre>
<p>Available options:</p>
<ul>
  <li>:checkpoint =&gt; Given a path, will store the resulting pcoll at this path in edn to facilitate dev/debug.</li>
  <li>:coder =&gt; Uses a specific Coder for the results of this transform. Usually defaults to some form of nippy-coder.</li>
  <li>:kind =&gt; Specifies if the input is a <code>:subscription</code> or a <code>:topic</code> (default to <code>:topic</code>).</li>
  <li>:name =&gt; Adds a name to the Transform.</li>
  <li>:timestamp-label =&gt; Set the timestamp of the message using a messageâ€™s attribute. The attribute should contain an Unix epoch in milliseconds.</li>
  <li>:type =&gt; Specify the type of message reader, default to <code>:string.</code> Possible values are <code>:string</code>: UTF-8 encoded strings, <code>:raw</code>: pubsub message with attributes.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/ngrunwald/datasplash/blob/v0.6.0/src/clj/datasplash/pubsub.clj#L49">view source</a></div></div><div class="public anchor" id="var-write-to-pubsub"><h3>write-to-pubsub</h3><h4 class="added">added in 0.4.0</h4><div class="usage"><code>(write-to-pubsub topic {:keys [type], :or {type :string}, :as options} pcoll)</code><code>(write-to-pubsub topic pcoll)</code></div><div class="doc"><div class="markdown"><p>Write the contents of an unbounded PCollection to to a pubsub stream.</p>
<p>See <a href="https://cloud.google.com/dataflow/model/pubsub-io#writing-with-pubsubio">https://cloud.google.com/dataflow/model/pubsub-io#writing-with-pubsubio</a>.</p>
<p>Examples:</p>
<pre><code>(ps/write-to-pubsub "projects/my-project/topics/my-topic" pcoll)

;; Assuming the input pcoll's elements are {:payload "my message" :attributes {:key value}}
(-&gt;&gt; (ps/encode-messages)
     (ps/write-from-to-pubsub "projects/my-project/topics/my-topic" {:type :raw} pcoll))
</code></pre>
<p>Available options:</p>
<ul>
  <li>:checkpoint =&gt; Given a path, will store the resulting pcoll at this path in edn to facilitate dev/debug.</li>
  <li>:coder =&gt; Uses a specific Coder for the results of this transform. Usually defaults to some form of nippy-coder.</li>
  <li>:name =&gt; Adds a name to the Transform.</li>
  <li>:type =&gt; Specify the type of message writer, default to <code>:string.</code> Possible values are <code>:string</code>: UTF-8 encoded strings, <code>:raw</code>: raw pubsub message.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/ngrunwald/datasplash/blob/v0.6.0/src/clj/datasplash/pubsub.clj#L83">view source</a></div></div></div></body></html>